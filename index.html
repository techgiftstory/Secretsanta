<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Secret Santa üéÖ</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: radial-gradient(circle at top, #222, #000);
    color: #fff;
    overflow: hidden;

    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

/* Snow */
#snow {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
}

/* Confetti */
#confetti {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 3;
}

/* Main card */
.card {
    position: relative;
    z-index: 2;
    width: 90vw;
    max-width: 380px;
    padding: 26px 22px 32px;
    border-radius: 18px;
    background: rgba(28,28,28,0.95);
    box-shadow: 0 0 30px rgba(255,255,255,0.18);
    text-align: center;
}

h2 {
    font-size: 26px;
    margin-bottom: 18px;
}

select, button {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
}

button {
    margin-top: 14px;
    background: crimson;
    color: white;
    cursor: pointer;
}

.result {
    margin-top: 20px;
    font-size: 20px;
}

/* üéÑ Merry Christmas Footer */
.footer {
    position: fixed;
    bottom: 14px;
    width: 100%;
    text-align: center;
    font-size: 14px;
    letter-spacing: 1px;
    color: #ffd700;
    z-index: 2;
    animation: glow 2s infinite alternate;
}

@keyframes glow {
    from { text-shadow: 0 0 6px #ffdf70; }
    to   { text-shadow: 0 0 14px #ffb700; }
}
</style>
</head>

<body>

<canvas id="snow"></canvas>
<canvas id="confetti"></canvas>

<div class="card">
    <h2>üéÅ Secret Santa</h2>

    <select id="nameSelect">
        <option value="">Select your name</option>
    </select>

    <button onclick="revealSanta()">Reveal</button>

    <div class="result" id="result"></div>
</div>

<div class="footer">üéÑ Merry Christmas üéÑ</div>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js" defer></script>

<script>
/* ================= EMAILJS INIT ================= */
window.addEventListener("DOMContentLoaded", function () {
    emailjs.init("d4pCP080P5Tsb8mSA"); // üî¥ replace with your key
});

/* ================= FIXED SEED ================= */
const SEED = "SECRET-SANTA-2025-DEC-20";

/* ================= SEEDED RANDOM ================= */
function seededRandom(seed) {
    let h = 2166136261 >>> 0;
    for (let i = 0; i < seed.length; i++) {
        h ^= seed.charCodeAt(i);
        h = Math.imul(h, 16777619);
    }
    return function () {
        h += h << 13; h ^= h >>> 7;
        h += h << 3;  h ^= h >>> 17;
        h += h << 5;
        return (h >>> 0) / 4294967296;
    };
}
const rand = seededRandom(SEED);

function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(rand() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

/* ================= SECRET SANTA ================= */
let assignments = {};
let peopleData = [];

fetch('data.txt')
.then(res => res.text())
.then(text => {
    peopleData = text.trim().split('\n').map(line => {
        const [name, status] = line.split(',');
        return { name: name.trim(), present: status.trim() === 'true' };
    });

    populateDropdown();
    generateAssignments();
});

function populateDropdown() {
    const select = document.getElementById('nameSelect');
    peopleData.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.name;
        opt.textContent = p.name;
        select.appendChild(opt);
    });
}

function generateAssignments() {
    const present = peopleData.filter(p => p.present).map(p => p.name);
    const absent  = peopleData.filter(p => !p.present).map(p => p.name);

    shuffle(present);
    shuffle(absent);

    assignCircular(present);
    assignCircular(absent);
}

function assignCircular(group) {
    if (group.length < 2) return;
    for (let i = 0; i < group.length; i++) {
        assignments[group[i]] = group[(i + 1) % group.length];
    }
}

function revealSanta() {
    const name = document.getElementById('nameSelect').value;
    if (!name) return;

    document.getElementById('result').innerHTML =
        `üéÅ You are Secret Santa for:<br><strong>${assignments[name]}</strong>`;

    burstConfetti();
    sendAdminEmail(name);
}

/* ================= EMAIL ================= */
function sendAdminEmail(name) {
    emailjs.send(
        "service_3vcerpc",
        "template_fw1fyrt",
        { name, time: new Date().toLocaleString() }
    );
}

/* ================= CONFETTI ================= */
const confettiCanvas = document.getElementById("confetti");
const cctx = confettiCanvas.getContext("2d");
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;

function burstConfetti() {
    let particles = Array.from({ length: 120 }, () => ({
        x: confettiCanvas.width / 2,
        y: confettiCanvas.height / 2,
        vx: (Math.random() - 0.5) * 8,
        vy: (Math.random() - 0.7) * 8,
        r: Math.random() * 4 + 2,
        c: `hsl(${Math.random()*360},100%,60%)`
    }));

    let frame = 0;
    function animate() {
        cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        particles.forEach(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.2;
            cctx.fillStyle = p.c;
            cctx.beginPath();
            cctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            cctx.fill();
        });
        frame++;
        if (frame < 60) requestAnimationFrame(animate);
        else cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    }
    animate();
}

/* ================= SNOW ================= */
const snow = document.getElementById("snow");
const sctx = snow.getContext("2d");
snow.width = window.innerWidth;
snow.height = window.innerHeight;

let flakes = Array.from({ length: 110 }, () => ({
    x: Math.random()*snow.width,
    y: Math.random()*snow.height,
    r: Math.random()*3+1,
    d: Math.random()+1
}));

setInterval(() => {
    sctx.clearRect(0,0,snow.width,snow.height);
    sctx.fillStyle="white";
    sctx.beginPath();
    flakes.forEach(f=>{
        sctx.moveTo(f.x,f.y);
        sctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        f.y+=f.d;
        if(f.y>snow.height) f.y=0;
    });
    sctx.fill();
},25);
</script>

</body>
</html>
