<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Secret Santa ğŸ…</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: radial-gradient(circle at top, #222, #000);
    color: #fff;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

/* Snow */
#snow {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
}

/* Confetti */
#confetti {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 3;
}

/* Wrapper */
.content {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 420px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Sleigh track */
.sleigh-track {
    width: 100%;
    height: 64px;
    position: relative;
    overflow: hidden;
    margin-bottom: 10px;
}

/* Sleigh */
.sleigh {
    position: absolute;
    top: 0;
    left: 10px;
    width: 230px;               /* ğŸ”‘ fixed width */
    display: flex;
    align-items: center;
    font-size: 30px;

    animation: sleighOscillate 8s ease-in-out infinite alternate;
}

/* Gift bounce */
.sleigh span:nth-child(n+4) {
    animation: giftBounce 1s infinite alternate;
}

/* Sparkle */
.sparkle {
    position: absolute;
    font-size: 14px;
    opacity: 0.9;
    animation: sparkleFade 1s linear forwards;
}

/* Card */
.card {
    width: 90vw;
    max-width: 380px;
    padding: 26px 22px 32px;
    border-radius: 18px;
    background: rgba(28,28,28,0.95);
    box-shadow: 0 0 30px rgba(255,255,255,0.18);
    text-align: center;
}

h2 {
    font-size: 26px;
    margin-bottom: 18px;
}

select, button {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
}

button {
    margin-top: 14px;
    background: crimson;
    color: white;
    cursor: pointer;
}

.result {
    margin-top: 20px;
    font-size: 20px;
}

/* Animations */
@keyframes sleighOscillate {
    from { left: 10px; }
    to   { left: calc(100% - 240px); } /* stays fully visible */
}

@keyframes giftBounce {
    from { transform: translateY(0); }
    to   { transform: translateY(-4px); }
}

@keyframes sparkleFade {
    from { opacity: 1; transform: translateY(0); }
    to   { opacity: 0; transform: translateY(10px); }
}
</style>
</head>

<body>

<canvas id="snow"></canvas>
<canvas id="confetti"></canvas>

<div class="content">

    <!-- ğŸ… Sleigh -->
    <div class="sleigh-track">
        <div class="sleigh" id="sleigh">
            <span>ğŸ¦Œ</span>
            <span>ğŸ¦Œ</span>
            <span>ğŸ…</span>
            <span>ğŸ›·</span>
            <span>ğŸ</span>
            <span>ğŸ</span>
            <span>ğŸ</span>
        </div>
    </div>

    <!-- ğŸ Card -->
    <div class="card">
        <h2>ğŸ Secret Santa</h2>

        <select id="nameSelect">
            <option value="">Select your name</option>
        </select>

        <button onclick="revealSanta()">Reveal</button>

        <div class="result" id="result"></div>
    </div>

</div>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js" defer></script>

<script>
/* EmailJS */
window.addEventListener("DOMContentLoaded", () => {
    emailjs.init("d4pCP080P5Tsb8mSA");
});

/* Seeded random */
const SEED = "SECRET-SANTA-2025-DEC-20";
function seededRandom(seed) {
    let h = 2166136261 >>> 0;
    for (let i = 0; i < seed.length; i++) {
        h ^= seed.charCodeAt(i);
        h = Math.imul(h, 16777619);
    }
    return () => {
        h += h << 13; h ^= h >>> 7;
        h += h << 3;  h ^= h >>> 17;
        h += h << 5;
        return (h >>> 0) / 4294967296;
    };
}
const rand = seededRandom(SEED);

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(rand() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
}

/* Secret Santa */
let assignments = {}, peopleData = [];

fetch('data.txt').then(r => r.text()).then(t => {
    peopleData = t.trim().split('\n').map(l => {
        const [n,s] = l.split(',');
        return { name: n.trim(), present: s.trim()==='true' };
    });
    const sel = document.getElementById('nameSelect');
    peopleData.forEach(p => {
        const o = document.createElement('option');
        o.value = p.name; o.textContent = p.name;
        sel.appendChild(o);
    });
    const pres = peopleData.filter(p=>p.present).map(p=>p.name);
    const abs  = peopleData.filter(p=>!p.present).map(p=>p.name);
    shuffle(pres); shuffle(abs);
    [...pres, ...abs].forEach((n,i,arr)=>assignments[n]=arr[(i+1)%arr.length]);
});

function revealSanta() {
    const name = nameSelect.value;
    if (!name) return;
    result.innerHTML = `ğŸ You are Secret Santa for:<br><strong>${assignments[name]}</strong>`;
    burstConfetti();
    emailjs.send("service_3vcerpc","template_fw1fyrt",{name,time:new Date().toLocaleString()});
}

/* Confetti */
const conf = document.getElementById("confetti");
const cctx = conf.getContext("2d");
conf.width = innerWidth; conf.height = innerHeight;
function burstConfetti(){
    const p = Array.from({length:120},()=>({
        x:conf.width/2,y:conf.height/2,
        vx:(Math.random()-.5)*8,vy:(Math.random()-.7)*8,
        r:Math.random()*4+2,c:`hsl(${Math.random()*360},100%,60%)`
    }));
    let f=0; (function anim(){
        cctx.clearRect(0,0,conf.width,conf.height);
        p.forEach(o=>{
            o.x+=o.vx; o.y+=o.vy; o.vy+=.2;
            cctx.fillStyle=o.c;
            cctx.beginPath(); cctx.arc(o.x,o.y,o.r,0,Math.PI*2); cctx.fill();
        });
        if(++f<60) requestAnimationFrame(anim);
    })();
}

/* Snow */
const snow = document.getElementById("snow");
const sctx = snow.getContext("2d");
snow.width=innerWidth; snow.height=innerHeight;
const flakes = Array.from({length:110},()=>({x:Math.random()*snow.width,y:Math.random()*snow.height,r:Math.random()*3+1,d:Math.random()+1}));
setInterval(()=>{
    sctx.clearRect(0,0,snow.width,snow.height);
    sctx.fillStyle="white"; sctx.beginPath();
    flakes.forEach(f=>{
        sctx.moveTo(f.x,f.y);
        sctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        f.y+=f.d; if(f.y>snow.height) f.y=0;
    });
    sctx.fill();
},25);

/* Sparkles */
setInterval(()=>{
    const sp=document.createElement("div");
    sp.className="sparkle"; sp.textContent="âœ¨";
    sp.style.left=(sleigh.offsetLeft+40)+"px";
    sp.style.top="18px";
    document.querySelector(".sleigh-track").appendChild(sp);
    setTimeout(()=>sp.remove(),1000);
},300);
</script>

</body>
</html>

